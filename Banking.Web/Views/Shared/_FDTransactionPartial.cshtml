
@model IEnumerable<BankingAppDataAccess.FixedDepositTransaction>
@{
    Layout = null;
    var compute = ViewBag.FDComputation as BankingAppDomain.Models.FDComputaionResult;
}

<div class="card shadow-sm p-3 mb-4">
    <h5 class="mb-3 text-primary">Fixed Deposit - Transactions</h5>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-info">@TempData["Message"]</div>
    }


    @if (compute != null)
    {
        <div class="mb-3">
            <div><strong>FD ID:</strong> @compute.FDAccountId</div>
            <div><strong>Principal:</strong> ₹@compute.Principal</div>
            <div><strong>ROI:</strong> @compute.RatePercent %</div>
            <div><strong>Start:</strong> @compute.StartDate.ToString("dd MMM yyyy")</div>
            <div><strong>End (Maturity):</strong> @compute.EndDate.ToString("dd MMM yyyy")</div>
            <div><strong>Accrued Interest (till today):</strong> ₹@compute.InterestAccrued</div>
            <div><strong>Matured:</strong> @(compute.IsMature ? "Yes" : "No")</div>
        </div>
    }


    @if (ViewBag.CanAddTransaction == true)
    {
        <div class="mb-3">
            <form method="post" action="@Url.Action("DoFDAction","Manager")" class="row g-2">
                <input type="hidden" name="fdId" value="@ViewBag.AccountId" />
                <div class="col-md-3">
                    <label class="form-label">Action</label>
                    <select name="action" class="form-select">
                        <option value="WITHDRAW" @(compute != null && compute.IsMature ? "" : "disabled")>Withdraw (if matured)</option>
                        <option value="FORECLOSE">Foreclose (early)</option>
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label">Credit To (Savings ID)</label>
                    <input type="text" name="creditSBAccountId" class="form-control" placeholder="SBAccountID (e.g. 000123)" />
                </div>

                <div class="col-md-2">
                    <label class="form-label">Penalty</label>
                    <input type="number" step="0.01" name="penaltyPercent" class="form-control" value="1.0", readonly = true/>
                </div>

                <div class="col-md-2 align-self-end">
                    <button type="submit" class="btn btn-danger w-100" onclick="return confirm('Proceed with FD action?');">
                        <i class="bi bi-x-circle"></i> Execute
                    </button>
                </div>
            </form>
        </div>
    }

    <hr />

    <h6 class="text-secondary">Transaction History</h6>
    @if (Model != null && Model.Any())
    {
        <table class="table table-bordered table-hover mt-3">
            <thead><tr><th>ID</th><th>Type</th><th>Amount</th><th>Date</th></tr></thead>
            <tbody>
                @foreach (var t in Model)
                {
                    <tr>
                        <td>@t.TransactionID</td>
                        <td>@t.TransactionType</td>
                        <td>₹@t.Amount</td>
                        <td>@t.TransactionDate.ToString()</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="alert alert-info">No FD transactions yet.</div>
    }
</div>